$(function () { var searchquery = "所有评审部门"; $("#dg_shpw_wsh").datagrid({ singleSelect: false, selectOnCheck: true, checkOnSelect: true, async: false, autoRowheight: false, collapsible: true, fit: true, method: 'post', url: '/xiangmuguanli/pw_shenhe_xm_wsh', toolbar: '#pl_ywzy_toolbar', rownumbers: true, pagination: true, autoRowheight: false, view: groupview, groupField: 'suoshuxueyuan', groupFormatter: function (value, rows) { return value + ' - ' + rows.length + ' 项' }, queryParams: { xiangmu: dgtitle, loingid: loingid, searchquery: searchquery }, onLoadSuccess: function (data) { $('.tianbiao').linkbutton({ text: '填表', plain: true }); $('.tianbiao').addClass("c6"); $('.tianbiao_jin').linkbutton({ text: '填表', disabled: true }); $('.pingshen').linkbutton({ text: '评审', plain: true }); $('.pingshen').addClass("c6"); $('.pingshen_jin').linkbutton({ text: '评审', disabled: true }); $('.rizhi').linkbutton({ text: '日志', plain: true }); $('.rizhi').addClass("c6"); $('.chehui').linkbutton({ text: '撤回', plain: true }); $('.chehui').addClass(" c6"); $('.chehui_jin').linkbutton({ text: '撤回', disabled: true }); $('.jianjie_all').tooltip({ position: 'left', onShow: function () { $(this).tooltip('tip').css({ width: '60%' }) } }) } }); var wsh = $('#dg_shpw_wsh').datagrid('getPager'); $(wsh).pagination({ pageSize: 10, pageList: [5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95, 100], beforePageText: '第', afterPageText: '页    共 {pages} 页', displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录', }); $('#suoshuxueyuan').combobox({ select: '所有评审部门', onChange: function (newValue, oldValue) { $('#dg_shpw_wsh').datagrid('load', { "xiangmu": dgtitle, "loingid": loingid, "searchquery": newValue }) } }) }); $.extend($.fn.combobox.methods, { selectedIndex: function (jq, index) { if (!index) index = 0; var data = $(jq).combobox('options').data; var vf = $(jq).combobox('options').valueField; $(jq).combobox('setValue', eval('data[index].' + vf)) } }); function changdu(xm_name) { value1 = xm_name; if (value1.length > 15) { value1 = value1.substr(0, 15) + "..." } return value1 }; function TitleFormatter(value, row, index) { var value1 = value; if (value1 == null) { var ss = '<a href="#" title="' + value + '"  class="easyui-tooltip"></a>'; return ss } else { if (value1.length > 15) { value1 = value1.substr(0, 15) + "..." } var ss = '<a href="#" title="' + value + '" onclick="pwchakan_wsh(' + index + ')" class="easyui-tooltip">' + value1 + '</a>'; return ss } }; function TitleFormatter_jj(value, row, index) { if (value == null) { var ss = ''; return ss } else { var value1 = value; if (value.length > 15) { value1 = value.substr(0, 15) + "..." } var ss = '<a href="javascript:;" title="' + value + '" class="jianjie_all">' + value1 + '</a>'; return ss } }; function bmfzrtubiao(value, row, index) { var bmfzrshenhe = row.bmfzrshenhe; switch (bmfzrshenhe) { case "通过": return "<Image src='/Scripts/easyui/themes/icons/ok.png' Title='通过'/>"; break; case "未审核": return "<Image src='/Scripts/easyui/themes/icons/question.png' Title='未审核'/>"; break; case "未通过": return "<Image src='/Scripts/easyui/themes/icons/no.png' Title='未通过'/>"; break } }; function fgldtubiao(value, row, index) { var fgldshenhe = row.fgldshenhe; switch (fgldshenhe) { case "通过": return "<Image src='/Scripts/easyui/themes/icons/ok.png' Title='通过'/>"; break; case "未审核": return "<Image src='/Scripts/easyui/themes/icons/question.png' Title='未审核'/>"; break; case "未通过": return "<Image src='/Scripts/easyui/themes/icons/no.png' Title='未通过'/>"; break } }; function pwshenhebubiao(value, row, index) { var pingweishenhe = row.pingweishenhe; switch (pingweishenhe) { case "通过": return "<Image src='/Scripts/easyui/themes/icons/ok.png' Title='通过'/>"; break; case "未通过": return "<Image src='/Scripts/easyui/themes/icons/no.png' Title='未通过'/>"; break; case "撤回": return "<Image src='/Scripts/easyui/themes/icons/chehui.png' Title='撤回'/>"; break; case "未审核": return "<Image src='/Scripts/easyui/themes/icons/question.png' Title='未审核'/>"; break } }; function pwchakan_wsh(index) { $('#dg_shpw_wsh').datagrid('selectRow', index); var row = $('#dg_shpw_wsh').datagrid('getSelected'); if (row) { var name = row.XmName; var id = row.ID; var xmmulu = row.Xiangmumulu; var tabTitle = "查看：" + changdu(name); var url = "/xiangmuguanli/chakan?NoticeXmName=" + name + "&xmmulu=" + xmmulu + "&xmid=" + id; var icon = "icon-shenhe"; window.parent.parent.addTab(tabTitle, url, icon); } }; function pw_shenhe_wsh(value, row, index) { return "<a href='javascript:void(0)' style='width:95%' class='pingshen' onclick='pw_caozuo_wsh(" + index + ")' target='mainFrame'>评审</a>" }; function pw_caozuo_wsh(index) { $('#fm_shpw').form('clear'); $('#dg_shpw_wsh').datagrid('selectRow', index); var row = $('#dg_shpw_wsh').datagrid('getSelected'); if (row) { $('#pwshenhe_dlg').dialog('open').dialog('setTitle', '评委审核'); var name = row.XmName; var id = row.ID; var xmmulu = row.Xiangmumulu; url = '/xiangmuguanli/pw_shenhe?name=' + name + '&loingid=' + loingid + '&xmid=' + id } }; function pwshenhe_save() { $('#fm_shpw').form('submit', { url: url, onSubmit: function () { return $(this).form('validate') }, success: function (result) { result = JSON.parse(result); if (result.success == false) { $.messager.show({ title: '错误提示', msg: result.errorMsg }) } if (result.success == true) { $('#pwshenhe_dlg').dialog('close'); $('#dg_shpw_wsh').datagrid('reload'); $('#dg_shpw_wc').datagrid('reload'); $.messager.show({ title: '提示', msg: result.errorMsg }) } } }) }; function pwchehui(value, row, index) { var fgldshenhe = row.fgldshenhe; var pingweishenhe = row.pingweishenhe; if (pingweishenhe == "未审核" && fgldshenhe == "通过") { return "<a href='javascript:void(0)' style='width:95%' class='chehui' onclick='pw_chehui_wsh(" + index + ")' target='mainFrame'>撤回</a>" } else { return "<a href='javascript:void(0)' style='width:95%' class='chehui_jin'>撤回</a>" } }; function pw_chehui_wsh(index) { $('#fm_pw_chehui').form('clear'); $('#dg_shpw_wsh').datagrid('selectRow', index); var row = $('#dg_shpw_wsh').datagrid('getSelected'); if (row) { $('#pw_chehui_dlg').dialog('open').dialog('setTitle', '评委撤回'); var name = row.XmName; var id = row.ID; var xmmulu = row.Xiangmumulu; url = '/xiangmuguanli/pw_chehui?name=' + name + '&loingid=' + loingid + '&xmid=' + id } }; function pwchehui_save() { $('#fm_pw_chehui').form('submit', { url: url, onSubmit: function () { return $(this).form('validate') }, success: function (result) { result = JSON.parse(result); if (result.success == false) { $.messager.show({ title: '错误提示', msg: result.errorMsg }) } if (result.success == true) { $('#pw_chehui_dlg').dialog('close'); $('#dg_shpw_wsh').datagrid('reload'); $.messager.show({ title: '提示', msg: result.errorMsg }) } } }) }; function pwxmrizhi_wsh(value, row, index) { return "<a href='javascript:void(0)' style='width:95%' class='rizhi' onclick='rizhichakan_wsh(" + index + ")' target='mainFrame'>日志</a>" }; function rizhichakan_wsh(index) { $('#dg_shpw_wsh').datagrid('selectRow', index); var row = $('#dg_shpw_wsh').datagrid('getSelected'); if (row) { var xmname = row.XmName; var id = row.ID; var xmmulu = row.Xiangmumulu; var tabTitle = "流程：" + changdu(xmname); var url = "/xiangmuguanli/liucheng?xmname=" + xmname + "&loingid=" + loingid + "&xmid=" + id; var icon = "icon-edit"; window.parent.parent.addTab(tabTitle, url, icon); } }; function tianbiao_pw_wsh(value, row, index) { var ywzyshenhe = row.ywzyshenhe; if (ywzyshenhe == "未审核") { return "<a href='javascript:void(0)' style='width:95%' class='tianbiao' onclick='wsxx_pw_wsh(" + index + ")' target='mainFrame'>填表</a>" } else { return "<a href='javascript:void(0)' style='width:95%' class='tianbiao_jin'>填表</a>" } }; function wsxx_pw_wsh(index) { $('#dg_shpw_wsh').datagrid('selectRow', index); var row = $('#dg_shpw_wsh').datagrid('getSelected'); if (row) { var name = row.XmName; var id = row.ID; var xmmulu = row.Xiangmumulu; var tabTitle = "填表：" + changdu(name); var url = "/xiangmuguanli/wanshanxinxi?NoticeXmName=" + name + "&xmmulu=" + xmmulu + "&xmid=" + id; var icon = "icon-edit"; window.parent.parent.addTab(tabTitle, url, icon); } }; var names; function pl_shenhe() { var checkedItems = $('#dg_shpw_wsh').datagrid('getChecked'); var names = []; if (checkedItems.length == 0) { $.messager.alert("错误提示", "请选择要审核的项目！", "warning") } else { if (checkedItems) { $('#shpwpl_shenhe_dlg').dialog('open').dialog('setTitle', '项目批量审核'); $('#shenhe_fm_pwpl').form('clear'); $.each(checkedItems, function (index, item) { names.push(item.ID); }); url = '/xiangmuguanli/plshenhe_pw?loingid=' + loingid + '&username=' + username + '&xmid=' + names } } }; function pl_pwsh_save() { $('#shenhe_fm_pwpl').form('submit', { url: url, onSubmit: function () { return $(this).form('validate') }, success: function (result) { result = JSON.parse(result); if (result.success == "2") { $.messager.show({ title: '错误提示', msg: result.errorMsg }) } if (result.success == "1") { $('#shpwpl_shenhe_dlg').dialog('close'); $('#dg_shpw_wsh').datagrid('reload'); $('#dg_shpw_wc').datagrid('reload'); $.messager.show({ title: '提示', msg: result.errorMsg }) } } }) };